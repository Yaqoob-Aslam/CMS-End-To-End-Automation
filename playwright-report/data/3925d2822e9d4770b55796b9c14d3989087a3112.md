# Test info

- Name: End-To-End-CMS-Application-Automation
- Location: /home/yaqoob/CMS-End-To-End-Automation/tests/CMS_Automation_1.0.spec.js:6:5

# Error details

```
Error: locator.waitFor: Target page, context or browser has been closed
Call log:
  - waiting for getByRole('button', { name: 'Done' }) to be visible

    at /home/yaqoob/CMS-End-To-End-Automation/tests/CMS_Automation_1.0.spec.js:162:18
```

# Test source

```ts
   62 |
   63 | require('dotenv').config(); // Add at the top of your test file
   64 |
   65 | // Then modify your login code to:
   66 | await page.getByRole('textbox', { name: 'Enter your email address' }).fill(process.env.CMS_EMAIL || '');
   67 | await page.getByRole('textbox', { name: 'Enter your password' }).fill(process.env.CMS_PASSWORD || '');
   68 |
   69 | // Add validation to fail fast if credentials are missing
   70 | if (!process.env.CMS_EMAIL || !process.env.CMS_PASSWORD) {
   71 |   throw new Error('Missing required environment variables: CMS_EMAIL and CMS_PASSWORD');
   72 | }
   73 |
   74 | await page.getByRole('button', { name: 'Login' }).click();
   75 | await page.waitForURL('**/dashboard', { timeout: 60000 });
   76 |
   77 | // ✅ Group
   78 | await page.getByRole('button', { name: 'Expand Icon' }).click();
   79 | await page.getByRole('link', { name: 'Groups' }).click();
   80 | await page.getByRole('listitem').filter({ hasText: /^Groups$/ }).getByRole('link').click();
   81 | await page.getByRole('button', { name: '+ Add Group' }).click();
   82 | await page.getByRole('textbox', { name: 'Enter group name' }).fill(groupName);
   83 | await page.getByRole('button', { name: 'Add' }).click();
   84 | await page.getByRole('button', { name: 'Done' }).click();
   85 |
   86 | // ✅ Subgroup
   87 | await page.getByRole('link', { name: 'Subgroups', exact: true }).click();
   88 | await page.getByRole('button', { name: '+ Add Subgroup' }).click();
   89 | await page.locator('.css-19bb58m').first().click();
   90 | await page.getByRole('option', { name: groupName }).click();
   91 | await page.getByRole('textbox', { name: 'Enter sub group name' }).fill(subGroupName);
   92 | await page.getByRole('button', { name: 'Add' }).click();
   93 | await page.getByRole('button', { name: 'Done' }).click();
   94 |
   95 | // ✅ Sub Subgroup
   96 | await page.getByRole('link', { name: 'Sub Subgroups' }).click();
   97 | await page.getByRole('button', { name: '+ Add Sub Subgroup' }).click();
   98 | await page.locator('.css-19bb58m').first().click();
   99 | await page.getByRole('option', { name: groupName }).click();
  100 |
  101 | // Ensure subgroup dropdown is opened before waiting for option
  102 | await page.locator('.css-35k6c7-control .css-19bb58m').click();
  103 | await page.getByRole('option', { name: subGroupName }).waitFor({ state: 'visible', timeout: 10000 });
  104 | await page.getByRole('option', { name: subGroupName }).click();
  105 |
  106 | await page.getByRole('textbox', { name: 'Enter sub subgroup name' }).fill(subSubGroupName);
  107 | await page.getByRole('button', { name: 'Add' }).click();
  108 | await page.getByRole('button', { name: 'Done' }).click();
  109 |
  110 | // ✅ Player
  111 | await page.getByRole('link', { name: 'Lan Manager' }).click();
  112 | await page.getByRole('list').filter({ hasText: /^Players$/ }).getByRole('link').click();
  113 | await page.getByRole('button', { name: '+ Add Player' }).click();
  114 | await page.locator('.css-19bb58m').first().click();
  115 | await page.getByRole('option', { name: groupName }).click();
  116 |
  117 | // Wait for subgroup combobox to become enabled
  118 | await page.waitForSelector('.css-35k6c7-control > .css-hlgwow > .css-19bb58m:not([aria-disabled="true"])', { timeout: 10000 });
  119 | await page.locator('.css-35k6c7-control > .css-hlgwow > .css-19bb58m').click();
  120 | await page.getByRole('option', { name: subGroupName }).click();
  121 |
  122 | // Wait for subsubgroup combobox to become enabled
  123 | await page.waitForSelector('div:nth-child(3) > .css-b62m3t-container > .css-35k6c7-control > .css-hlgwow > .css-19bb58m:not([aria-disabled="true"])', { timeout: 10000 });
  124 | await page.locator('div:nth-child(3) > .css-b62m3t-container > .css-35k6c7-control > .css-hlgwow > .css-19bb58m').click();
  125 | await page.getByRole('option', { name: subSubGroupName }).click();
  126 |
  127 | await page.getByRole('textbox', { name: 'Enter player name' }).fill(playerName);
  128 | await page.getByRole('button', { name: 'Add' }).click();
  129 | // Wait for success dialog and click "Done"
  130 | await page.waitForSelector('text=Player added successfully.', { timeout: 15000 });
  131 | await page.getByRole('button', { name: 'Done' }).click();
  132 | console.log(`✅ Player Created: ${playerName}`);
  133 |
  134 | // ✅ Upload Video
  135 | await page.getByRole('link', { name: 'Contents' }).click();
  136 | await page.getByRole('link', { name: 'Scenario' }).click();
  137 | await page.getByRole('button', { name: 'All Videos' }).click();
  138 | await page.getByRole('button', { name: '+ Add Videos' }).click();
  139 | // Check if video file exists and is under 50MB before upload
  140 | const videoPath = path.join(videoDir, videoFileName);
  141 | if (!fs.existsSync(videoPath)) {
  142 |   throw new Error(`Video file not found: ${videoPath}`);
  143 | }
  144 | const stats = fs.statSync(videoPath);
  145 | if (stats.size > 50 * 1024 * 1024) {
  146 |   throw new Error(`Video file exceeds 50MB: ${videoFileName}`);
  147 | }
  148 |
  149 | await page.locator('input[type="file"]').setInputFiles(videoPath);
  150 | await page.waitForSelector(`text=${videoFileName}`, { timeout: 180000 }); // Increased timeout to 3 minutes
  151 |
  152 | // Wait for loading indicator to disappear before clicking "Add"
  153 | await page.waitForSelector('text=Loading...', { state: 'detached', timeout: 480000 });
  154 |
  155 | // Click "Add" button in the dialog after video appears and loading is done
  156 | const addVideoButton = page.getByRole('button', { name: 'Add' });
  157 | await addVideoButton.waitFor({ state: 'visible', timeout: 30000 });
  158 | await addVideoButton.click();
  159 |
  160 | // Wait for "Done" button to be visible before clicking
  161 | const doneButton = page.getByRole('button', { name: 'Done' });
> 162 | await doneButton.waitFor({ state: 'visible', timeout: 30000 });
      |                  ^ Error: locator.waitFor: Target page, context or browser has been closed
  163 | await doneButton.click();
  164 | console.log(`✅ Uploaded video: ${videoFileName}`);
  165 |
  166 |
  167 | // ✅ Scenario
  168 | await page.getByRole('button', { name: 'All Scenarios' }).click();
  169 | await page.getByRole('button', { name: '+ Make Scenario' }).click();
  170 | await page.getByRole('textbox', { name: 'Enter scenario name' }).fill(scenarioName);
  171 | await page.locator('.css-19bb58m').click();
  172 | await page.getByRole('option', { name: videoFileName }).click();
  173 |
  174 | // Wait for "Add" button to be visible and enabled before clicking
  175 | const scenarioAddButton = page.getByRole('button', { name: 'Add' });
  176 | await scenarioAddButton.waitFor({ state: 'visible', timeout: 15000 });
  177 | await expect(scenarioAddButton).toBeEnabled({ timeout: 15000 });
  178 | await scenarioAddButton.click();
  179 |
  180 | const scenarioDoneButton = page.getByRole('button', { name: 'Done' });
  181 | await scenarioDoneButton.waitFor({ state: 'visible', timeout: 5000 });
  182 | await scenarioDoneButton.click();
  183 | console.log(`✅ Scenario Created: ${scenarioName}`);
  184 |
  185 | // ✅ Time Table
  186 | await page.getByRole('link', { name: 'Time Table' }).click({ timeout: 10000 } );
  187 | await page.getByRole('button', { name: '+ Add Time Table' }).click();
  188 |
  189 | const now = new Date();
  190 | const startTime = now.toTimeString().slice(0, 5);
  191 | const endDate = new Date(now.getTime() + 5 * 60000);
  192 | const endTime = endDate.toTimeString().slice(0, 5);
  193 |
  194 | await page.getByRole('textbox', { name: 'Enter time table name' }, { timeout: 5000 }).click();
  195 | await page.getByRole('textbox', { name: 'Enter time table name' }).fill(timetableName);
  196 | await page.locator('.css-19bb58m').click();
  197 | await page.getByRole('option', { name: scenarioName }, { timeout: 5000 }).click();
  198 | await page.getByPlaceholder('Select start time').click({ timeout: 10000 });
  199 | await page.getByPlaceholder('Select start time').fill(startTime);
  200 | await page.getByPlaceholder('Select end time').click({ timeout: 10000 });
  201 | await page.getByPlaceholder('Select end time').fill(endTime);
  202 | await page.getByRole('button', { name: 'Add' }).click();
  203 | await page.getByRole('button', { name: 'Done'}, { timeout: 5000 }).click();
  204 | console.log(`✅ Timetable Created: ${timetableName}`);
  205 |
  206 |
  207 | // ✅ Schedule
  208 | await page.getByRole('link', { name: 'Schedule' }).click();
  209 | await page.getByRole('button', { name: '+ Add Schedule' }).click();
  210 | await page.getByRole('textbox', { name: 'Enter schedule name' }).fill(scheduleName);
  211 | await page.locator('.css-19bb58m').click();
  212 | await page.getByRole('option', { name: timetableName }).click();
  213 | const today = new Date().getDate().toString();
  214 | // Select Start Date
  215 | await page.getByRole('textbox', { name: 'Select start date' }).click();
  216 | await page.waitForSelector(`.react-datepicker__day >> text="${today}"`, { timeout: 5000 });
  217 | await page.locator(`.react-datepicker__day >> text="${today}"`).first().click({ timeout: 5000 });
  218 | // Select End Date
  219 | await page.getByRole('textbox', { name: 'Select end date' }).click({ timeout: 5000 });
  220 | await page.waitForSelector(`.react-datepicker__day >> text="${today}"`, { timeout: 5000 });
  221 | await page.locator(`.react-datepicker__day >> text="${today}"`).first().click();
  222 |
  223 | // Wait for "Add" button to be visible before clicking
  224 | const addButton = page.getByRole('button', { name: 'Add' });
  225 | await addButton.waitFor({ state: 'visible', timeout: 10000 });
  226 | await addButton.click({ timeout: 5000 });
  227 |
  228 | await page.waitForSelector('text=Schedule added successfully.', { timeout: 15000 });
  229 | await page.getByRole('button', { name: 'Done' }).waitFor({ state: 'visible', timeout: 10000 });
  230 | await page.getByRole('button', { name: 'Done' }).click({ timeout: 5000 });
  231 | console.log(`✅ Schedule Created: ${scheduleName} using current date`);
  232 |
  233 |
  234 | // ✅ Assign Scenario to Player
  235 | await page.getByRole('link', { name: 'Dashboard' }).click();
  236 | await page.getByRole('button', { name: '+ Assign Scenario' }).click();
  237 | // Select Scenario (use lastly generated name)
  238 | await page.locator('.css-19bb58m').first().click();
  239 | await page.getByRole('option', { name: scenarioName }).click();
  240 | // Select Player (use lastly generated name)
  241 | await page.locator('.css-35k6c7-control > .css-hlgwow > .css-19bb58m').click();
  242 | await page.getByRole('option', { name: playerName }).click();
  243 |
  244 | await page.getByRole('button', { name: 'Add' }).click();
  245 | await page.getByRole('button', { name: 'Done' }).click();
  246 |
  247 | // ✅ Generate unique real names and email
  248 | const firstNames = ['Ali', 'Sara', 'Usman', 'Ayesha', 'Omar', 'Fatima', 'Bilal', 'Hira', 'Zain', 'Zara'];
  249 | const lastNames = ['Khan', 'Malik', 'Sheikh', 'Qureshi', 'Butt', 'Raza', 'Shah', 'Chaudhry', 'Hussain', 'Mirza'];
  250 |
  251 | function getRandomName(arr) {
  252 |   return arr[Math.floor(Math.random() * arr.length)];
  253 | }
  254 |
  255 | const uniqueFirstName = getRandomName(firstNames);
  256 | const uniqueLastName = getRandomName(lastNames);
  257 | const uniqueEmail = `${uniqueFirstName.toLowerCase()}.${uniqueLastName.toLowerCase()}${groupNumber}@mailinator.com`; // public temp email
  258 |
  259 | // ✅ Create Manager with unique details
  260 | await page.getByRole('link', { name: 'User Account' }).click();
  261 | await page.getByRole('button', { name: '+ Create Manager' }).click();
  262 |
```