# Test info

- Name: End-To-End-CMS-Application-Automation
- Location: /home/yaqoob/CMS-End-To-End-Automation/tests/CMS_Automation_1.0.spec.js:6:5

# Error details

```
Error: page.goto: Target page, context or browser has been closed
Call log:
  - navigating to "https://moyai-cms.innov8.jp/login", waiting until "load"

    at /home/yaqoob/CMS-End-To-End-Automation/tests/CMS_Automation_1.0.spec.js:61:12
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { chromium } from 'playwright';
   3 | import fs from 'fs';
   4 | import path from 'path';
   5 |
   6 | test('End-To-End-CMS-Application-Automation', async ({}, testInfo) => {
   7 |
   8 |   try {
   9 |     // Your existing test code
   10 |   } catch (error) {
   11 |     await testInfo.attach('error-screenshot', {
   12 |       body: await page.screenshot(),
   13 |       contentType: 'image/png',z
   14 |     });
   15 |     throw error;
   16 |   } finally {
   17 | }
   18 | const groupNumber = Math.floor(Math.random() * 100000);
   19 | const groupName = `Group U${groupNumber}`;
   20 | const subGroupName = `Subgroup U${groupNumber}`;
   21 | const subSubGroupName = `Sub Subgroup U${groupNumber}`;
   22 | const playerName = `Player U${groupNumber}`;
   23 | const videoFileName = `test__${groupNumber}.mp4`;
   24 | const scenarioName = `Scenario U${groupNumber}`; 
   25 | const timetableName = `Timetable U${groupNumber}`;
   26 | const scheduleName = `Schedule U${groupNumber}`; 
   27 |   test.slow(); // Easy way to triple the default timeout
   28 |
   29 | // ✅ Locate the video from project-root/videos/
   30 | const projectRoot = path.resolve(__dirname, '..');
   31 | const videoDir = path.join(projectRoot, 'videos');
   32 | const existingFiles = fs.existsSync(videoDir) ? fs.readdirSync(videoDir) : [];
   33 | const firstVideo = existingFiles.find(file => file.endsWith('.mp4'));
   34 |
   35 | if (!firstVideo) {
   36 | console.warn('⚠️ No video found in videos/ folder');
   37 | return;
   38 | }
   39 |
   40 | // ✅ Rename to unique filename
   41 | const oldPath = path.join(videoDir, firstVideo);
   42 | const newPath = path.join(videoDir, videoFileName);
   43 | fs.renameSync(oldPath, newPath);
   44 | console.log(`🆕 Renamed video: ${firstVideo} ➝ ${videoFileName}`);
   45 |
   46 | const browser = await chromium.launch({
   47 |
   48 | // headless: true, // ✅ GitHub Actions
   49 |  headless: false, 
   50 | args: ['--start-maximized'],
   51 | });
   52 |
   53 | const context = await browser.newContext({
   54 | viewport: null,
   55 | deviceScaleFactor: undefined,
   56 | });
   57 |
   58 | const page = await context.newPage();
   59 |
   60 | // ✅ Login
>  61 | await page.goto('https://moyai-cms.innov8.jp/login', { timeout: 90000 }); // Increased timeout to 90 seconds
      |            ^ Error: page.goto: Target page, context or browser has been closed
   62 |
   63 | require('dotenv').config(); // Add at the top of your test file
   64 |
   65 | // Then modify your login code to:
   66 | await page.getByRole('textbox', { name: 'Enter your email address' }).fill(process.env.CMS_EMAIL || '');
   67 | await page.getByRole('textbox', { name: 'Enter your password' }).fill(process.env.CMS_PASSWORD || '');
   68 |
   69 | // Add validation to fail fast if credentials are missing
   70 | if (!process.env.CMS_EMAIL || !process.env.CMS_PASSWORD) {
   71 |   throw new Error('Missing required environment variables: CMS_EMAIL and CMS_PASSWORD');
   72 | }
   73 |
   74 | await page.getByRole('button', { name: 'Login' }).click();
   75 | await page.waitForURL('**/dashboard', { timeout: 60000 });
   76 |
   77 | // ✅ Group
   78 | await page.getByRole('button', { name: 'Expand Icon' }).click();
   79 | await page.getByRole('link', { name: 'Groups' }).click();
   80 | await page.getByRole('listitem').filter({ hasText: /^Groups$/ }).getByRole('link').click();
   81 | await page.getByRole('button', { name: '+ Add Group' }).click();
   82 | await page.getByRole('textbox', { name: 'Enter group name' }).fill(groupName);
   83 | await page.getByRole('button', { name: 'Add' }).click();
   84 | await page.getByRole('button', { name: 'Done' }).click();
   85 |
   86 | // ✅ Subgroup
   87 | await page.getByRole('link', { name: 'Subgroups', exact: true }).click();
   88 | await page.getByRole('button', { name: '+ Add Subgroup' }).click();
   89 | await page.locator('.css-19bb58m').first().click();
   90 | await page.getByRole('option', { name: groupName }).click();
   91 | await page.getByRole('textbox', { name: 'Enter sub group name' }).fill(subGroupName);
   92 | await page.getByRole('button', { name: 'Add' }).click();
   93 | await page.getByRole('button', { name: 'Done' }).click();
   94 |
   95 | // ✅ Sub Subgroup
   96 | await page.getByRole('link', { name: 'Sub Subgroups' }).click();
   97 | await page.getByRole('button', { name: '+ Add Sub Subgroup' }).click();
   98 | await page.locator('.css-19bb58m').first().click();
   99 | await page.getByRole('option', { name: groupName }).click();
  100 |
  101 | // Ensure subgroup dropdown is opened before waiting for option
  102 | await page.locator('.css-35k6c7-control .css-19bb58m').click();
  103 | await page.getByRole('option', { name: subGroupName }).waitFor({ state: 'visible', timeout: 10000 });
  104 | await page.getByRole('option', { name: subGroupName }).click();
  105 |
  106 | await page.getByRole('textbox', { name: 'Enter sub subgroup name' }).fill(subSubGroupName);
  107 | await page.getByRole('button', { name: 'Add' }).click();
  108 | await page.getByRole('button', { name: 'Done' }).click();
  109 |
  110 | // ✅ Player
  111 | await page.getByRole('link', { name: 'Lan Manager' }).click();
  112 | await page.getByRole('list').filter({ hasText: /^Players$/ }).getByRole('link').click();
  113 | await page.getByRole('button', { name: '+ Add Player' }).click();
  114 | await page.locator('.css-19bb58m').first().click();
  115 | await page.getByRole('option', { name: groupName }).click();
  116 |
  117 | // Wait for subgroup combobox to become enabled
  118 | await page.waitForSelector('.css-35k6c7-control > .css-hlgwow > .css-19bb58m:not([aria-disabled="true"])', { timeout: 10000 });
  119 | await page.locator('.css-35k6c7-control > .css-hlgwow > .css-19bb58m').click();
  120 | await page.getByRole('option', { name: subGroupName }).click();
  121 |
  122 | // Wait for subsubgroup combobox to become enabled
  123 | await page.waitForSelector('div:nth-child(3) > .css-b62m3t-container > .css-35k6c7-control > .css-hlgwow > .css-19bb58m:not([aria-disabled="true"])', { timeout: 10000 });
  124 | await page.locator('div:nth-child(3) > .css-b62m3t-container > .css-35k6c7-control > .css-hlgwow > .css-19bb58m').click();
  125 | await page.getByRole('option', { name: subSubGroupName }).click();
  126 |
  127 | await page.getByRole('textbox', { name: 'Enter player name' }).fill(playerName);
  128 | await page.getByRole('button', { name: 'Add' }).click();
  129 | // Wait for success dialog and click "Done"
  130 | await page.waitForSelector('text=Player added successfully.', { timeout: 15000 });
  131 | await page.getByRole('button', { name: 'Done' }).click();
  132 | console.log(`✅ Player Created: ${playerName}`);
  133 |
  134 | // ✅ Upload Video
  135 | await page.getByRole('link', { name: 'Contents' }).click();
  136 | await page.getByRole('link', { name: 'Scenario' }).click();
  137 | await page.getByRole('button', { name: 'All Videos' }).click();
  138 | await page.getByRole('button', { name: '+ Add Videos' }).click();
  139 | // Check if video file exists and is under 50MB before upload
  140 | const videoPath = path.join(videoDir, videoFileName);
  141 | if (!fs.existsSync(videoPath)) {
  142 |   throw new Error(`Video file not found: ${videoPath}`);
  143 | }
  144 | const stats = fs.statSync(videoPath);
  145 | if (stats.size > 50 * 1024 * 1024) {
  146 |   throw new Error(`Video file exceeds 50MB: ${videoFileName}`);
  147 | }
  148 |
  149 | await page.locator('input[type="file"]').setInputFiles(videoPath);
  150 | await page.waitForSelector(`text=${videoFileName}`, { timeout: 180000 }); // Increased timeout to 3 minutes
  151 |
  152 | // Wait for loading indicator to disappear before clicking "Add"
  153 | await page.waitForSelector('text=Loading...', { state: 'detached', timeout: 480000 });
  154 |
  155 | // Click "Add" button in the dialog after video appears and loading is done
  156 | const addVideoButton = page.getByRole('button', { name: 'Add' });
  157 | await addVideoButton.waitFor({ state: 'visible', timeout: 30000 });
  158 | await addVideoButton.click();
  159 |
  160 | // Wait for "Done" button to be visible before clicking
  161 | const doneButton = page.getByRole('button', { name: 'Done' });
```